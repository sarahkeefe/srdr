(function ($) { $.fn.popBox = function (options) { var defaults = { height: 100, width: 300, newlineString: "<br/>" }; var options = $.extend(defaults, options); return this.each(function () { obj = $(this); obj.after('<div class="popBox-holder"></div><div class="popBox-container"><textarea class="popBox-input" /><div class="done-button"><input type="button" value="Done" class="button blue small"/></div></div>'); obj.focus(function () { $(this).next(".popBox-holder").show(); $(this).next().next(".popBox-container").children('.popBox-input').css({ height: options.height, width: options.width }); $(this).next().next(".popBox-container").show(); var scrolled = $(document).scrollTop(); var top = ($(window).height() - $(this).next().next(".popBox-container").outerHeight()) / 2 + scrolled; var left = ($(window).width() - $(this).next().next(".popBox-container").outerWidth()) / 2; $(".popBox-holder").css({ top: scrolled }); $(this).next().next(".popBox-container").css({ position: 'fixed', margin: 0, top: (top > 0 ? top : 0) + 'px', left: (left > 0 ? left : 0) + 'px' }); $(this).next().next(".popBox-container").children('.popBox-input').val($(this).val().replace(RegExp(options.newlineString, "g"), "\n")); $(this).next().next(".popBox-container").children('.popBox-input').focus(); $(this).next().next(".popBox-container").children().blur(function () { $(this).parent().hide(); $(this).parent().prev().hide(); $(this).parent().prev().prev().val($(this).val().replace(/\n/g, options.newlineString)); }); }); }); }; })(jQuery);